測試執行流程手冊（Test Execution Handbook）

更新日期：2025-12-12

參考文件

- 策略總覽：[exchange-web-app/src/test/docs/1.測試策略與範圍.md](exchange-web-app/src/test/docs/1.%E6%B8%AC%E8%A9%A6%E7%AD%96%E7%95%A5%E8%88%87%E7%AF%84%E5%9C%8D.md)
- 功能測試：[exchange-web-app/src/test/docs/2.功能測試設計.md](exchange-web-app/src/test/docs/2.%E5%8A%9F%E8%83%BD%E6%B8%AC%E8%A9%A6%E8%A8%AD%E8%A8%88.md)
- Web 架構：[exchange-web-app/src/test/docs/3.Web 架構專屬測試.md](exchange-web-app/src/test/docs/3.Web%20%E6%9E%B6%E6%A7%8B%E5%B0%88%E5%B1%AC%E6%B8%AC%E8%A9%A6.md)
- 非功能性：[exchange-web-app/src/test/docs/4.系統非功能性測試.md](exchange-web-app/src/test/docs/4.%E7%B3%BB%E7%B5%B1%E9%9D%9E%E5%8A%9F%E8%83%BD%E6%80%A7%E6%B8%AC%E8%A9%A6.md)

一、整體流程（Execution Process）

- 流程：單元測試 → 整合測試 → 系統測試（功能＋Web 架構＋非功能）→ 回歸測試 → 簽核（Sign-off）

二、階段 1：單元測試（Unit Testing）

- 目的：驗證核心邏輯與 Class 穩定性與分支/邊界條件。
- 前置資源：測試資料庫設定（參考 target/test-classes/application-test.yml）、Mock 物件、Fake Repository。
- 主要對象：`ProposalService`、`ChatService/NegotiationService`、`ShipmentService/TrackingService`、`DeliveryService`、共用 Utils（參考策略文件）。
- 步驟：
  1) 撰寫/補齊 JUnit 測試，覆蓋成功、失敗與例外路徑。
  2) 於本機/CI 執行測試並產出報告。
- 建議命令（Windows）：

```powershell
mvn -q -DskipITs=true test
```

- 產出物：
  - 測試結果報告（JUnit XML/HTML）。
  - 覆蓋率報告（如使用 JaCoCo）。
- 通過門檻：
  - 報告通過率 ≥ 95%。
  - 分支/條件覆蓋率 ≥ 80%（核心服務）。

三、階段 2：整合測試（Integration Testing）

- 目的：驗證前端（JSP/Thymeleaf）與後端 Controller 的資料綁定與 API 正確性。
- 前置資源：`SpringBootTest`＋`MockMvc` 基底、測試資料庫、外部 Stub（SMTP/OAuth/物流）。
- 主要對象：`/ui/*` 頁面模型、`/api/auth/login`、`/api/listings`、`/api/proposals`、`/api/chat/{roomId}/messages`、`/api/shipment/{id}/update`。
- 步驟：
  1) 以 MockMvc 驗證表單綁定/模型屬性與 REST 回應（200/4xx/5xx）。
  2) 對需要登入之路徑驗證 302→登入頁或 401/403。
- 建議命令：

```powershell
mvn -q -Dit.test=*IT verify
```

- 產出物：
  - 整合測試報告（XML/HTML）。
  - 錯誤與例外處理證據（日誌擷取）。
- 通過門檻：
  - 主要端點的成功/失敗路徑皆被覆蓋；未授權行為正確阻擋。

四、階段 3：系統測試（System Testing，重點）

- 目的：執行功能、Web 架構、非功能性測試全套案例。
- 前置資源：E2E 測試框架（Selenium/Playwright）、連結檢查腳本（或 MockMvc+jsoup）、JMeter/K6、ZAP/自動化安全檢測（可選）、測試資料集。

3A. 功能測試（見功能測試設計）

- 對象：UC-01~UC-08 端到端流程。
- 產出物：測試腳本與執行報告、失敗重現步驟、截圖/錄影（如適用）。

3B. Web 架構測試（見 Web 架構專屬測試）

- 對象：
  - 孤兒頁面檢測（templates/*.html 與實際路由比對）。
  - 幽靈頁面/失效連結檢測（站內所有 a[href]/form[action]）。
- 產出物：連結有效性報告（來源頁/元素/目標 URL/狀態碼/結果）。

3C. 非功能性測試（見非功能性測試計畫）

- 安全性：未授權訪問、XSS、SQLi/排序白名單。
- 恢復：DB 斷線回滾、外部服務中斷重試、重啟一致性。
- 壓力：1000 併發登入、聊天高頻訊息、批次郵件。
- 效能：首頁 TTFB/載入時間、搜尋 P95 與索引命中。
- 產出物：
  - 缺陷報告（Bug Report）。
  - 測試結果報告（Test Summary Report）。

五、階段 4：回歸測試（Regression Test）

- 目的：針對已修復缺陷進行針對性重測與關聯區域 Sanity，確保無副作用。
- 步驟：
  1) 缺陷修復提交後，關聯測試案例標記並重跑。
  2) 受影響模組執行快速回歸套件（冒煙/Sanity）。
- 產出物：回歸測試報告、缺陷狀態更新（Resolved/Verified/Closed）。
- 通過門檻：所有關聯案例通過，且未新增 Sev1/Sev2 缺陷。

六、測試結束標準（Completion Criteria）

- 功能性門檻：所有 High Priority 測試案例 100% 通過。
- 覆蓋率門檻：頁面覆蓋率（Page Coverage）達到 100%（見 Web 架構測試）。
- 缺陷殘留門檻：系統中不得殘留任何 Severity 1 關鍵性缺陷。
- 建議附加：主要端點 P95 響應符合效能門檻（首頁 < 3s；搜尋 < 2s）。

七、角色責任劃分（R&R）

- 開發工程師：
  - 撰寫與維護單元/整合測試；提供測試資料與測試可注入點（Clock/IdGenerator）。
  - 缺陷修復與自測；支援回歸測試解題。
- 測試工程師（QA）：
  - 規劃與執行系統測試（功能、Web 架構、非功能）、出具報告與度量。
  - 缺陷管理與優先級評估；推動回歸與簽核。
- 測試架構師（TA）：
  - 制定策略與門檻、工具選型與框架維護；審核覆蓋率與風險。
- （選）運維：
  - 壓力/效能測試的環境與監控（CPU/RAM/GC/DB 指標）。

八、測試總結報告（Test Summary Report）簡要模版

標頭

- 專案/版本：
- 測試期間：
- 測試負責人：

概覽

- 測試範圍與變更重點：
- 測試環境與版本（後端/前端/DB/外部 Stub）：

度量摘要

- 用例統計：Total/Passed/Failed/Blocked/Not Run（按優先權拆解）。
- 覆蓋率：
  - 單元分支/條件覆蓋率：__%
  - 頁面覆蓋率（Page Coverage）：__%（目標：100%）
  - 連結覆蓋率（Link Coverage）：__%
  - Define-Use 覆蓋率：__%
- 效能指標：首頁 TTFB/載入、搜尋 P95、錯誤率。

缺陷分佈

- 缺陷總數：N（Sev1/Sev2/Sev3）
- 模組分佈：Auth/Listing/Proposal/Chat/Shipment/Tracking/Delivery/Email
- 修復進度：Resolved/Verified/Closed 比例

結論（Pass/Fail/With Concerns）

- 符合度：是否達成 High Priority 100% 通過、頁面覆蓋 100%、Sev1=0。
- 主要風險與建議：

附錄

- 測試數據集與腳本位置：
- 報告與原始資料連結：

九、執行附註（實務建議）

- 在 PR 檢查中自動執行連結健康檢查與基本未授權訪問測試；將失效連結數量設為阻擋閾值。
- 為外部整合提供可切換的 Stub/Mock 設定，便於系統測試與回歸測試的可重現性。
- 對長鏈路狀態機（提案→協商→出貨→追蹤→送達）建立測試資料工廠與重播腳本，縮短回歸時間。
