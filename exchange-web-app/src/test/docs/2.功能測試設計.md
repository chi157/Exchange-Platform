核心功能測試設計（Functional Testing）

更新日期：2025-12-12

前言

- 本文件依據現有系統功能（UC-01~UC-08：認證、刊登、搜尋篩選、提案、協商聊天、出貨、追蹤、送達確認）設計黑箱/使用案例測試矩陣，確保對 SRS 與主要流程的可追溯性。
- 測試方法包含：等價劃分、邊界值分析、錯誤猜測、安全性檢查與用例導向測試。
- 預期結果統一包含三構面：HTTP/UI 回應、頁面/導向變化、資料庫/狀態機更新。

步驟 A：需求追溯矩陣（RTM）

| 需求 ID | 功能名稱 | 對應 Use Case | 優先權 | 測試狀態 |
| :--- | :--- | :--- | :--- | :--- |
| R1 | 使用者登入（帳密/Google OAuth） | UC-01 | High | 待執行 |
| R2 | 使用者登出 | UC-01 | High | 待執行 |
| R3 | 註冊與基本資料維護 | UC-01 | High | 待執行 |
| R4 | 刊登建立/編輯/刪除（CRUD） | UC-02 | High | 待執行 |
| R5 | 刊登搜尋與篩選、分頁排序 | UC-03 | High | 待執行 |
| R6 | 交換提案建立/接受/拒絕/取消 | UC-04 | High | 待執行 |
| R7 | 協商聊天（訊息送出/房間狀態） | UC-05 | High | 待執行 |
| R8 | 配送方式設定（面交/交貨便） | UC-06 | High | 待執行 |
| R9 | 物流追蹤（事件更新/查詢） | UC-07 | High | 待執行 |
| R10 | 送達確認（雙方簽收完成） | UC-08 | High | 待執行 |
| R11 | 郵件通知（模板渲染/寄送/失敗處理） | N/A（跨用例） | Medium | 待執行 |

步驟 B：測試個案矩陣（Test Case Matrix）

測試模組：認證與帳戶（登入/登出/註冊）

- 測試目的：驗證認證流程在正常/異常/極端輸入下的正確性與安全性。

| 測試編號 | 情境描述 | 輸入資料 | 預期結果 | 測試方法/技術 |
| :--- | :--- | :--- | :--- | :--- |
| TC-AU01 | 成功登入（帳密） | 有效帳號+正確密碼 | 200；導向首頁；會話建立；DB/審計記錄登入事件 | Use Case |
| TC-AU02 | 密碼錯誤 | 有效帳號+錯誤密碼 | 401；停留登入頁顯示錯誤；無會話建立；審計記錄失敗 | 等價劃分 |
| TC-AU03 | 帳號不存在 | 不存在帳號 | 404/401；錯誤提示；無會話 | 錯誤猜測 |
| TC-AU04 | 邊界值-密碼長度 | 最短/最長邊界 | 400（不符策略）或成功；提示清楚 | 邊界值分析 |
| TC-AU05 | OAuth 成功 | Google 回調有效 Code | 302 導向首頁；建立綁定會話；審計記錄 | Use Case |
| TC-AU06 | OAuth 拒絕授權 | 授權失敗 | 302 回登入頁；顯示拒絕訊息；無會話 | 錯誤猜測 |
| TC-AU07 | 登出 | 已登入使用者 | 302 導向登入頁；會話清除；審計記錄 | Use Case |
| TC-AU08 | 註冊成功 | 合法 Email/暱稱/密碼 | 201；導向登入或自動登入；DB 建立使用者 | Use Case |
| TC-AU09 | 註冊異常輸入 | 非法 Email/空值/弱密碼 | 400；欄位錯誤提示；DB 不應新增 | 等價劃分 |
| TC-AU10 | 安全性：暴力嘗試 | 多次錯誤登入 | 429 或鎖定策略；審計告警 | 安全性測試 |

測試模組：刊登管理（建立/編輯/刪除/列表）

- 測試目的：驗證刊登 CRUD 與列表顯示、權限與資料驗證正確性。

| 測試編號 | 情境描述 | 輸入資料 | 預期結果 | 測試方法/技術 |
| :--- | :--- | :--- | :--- | :--- |
| TC-LS01 | 建立刊登成功 | 完整合法表單（名稱、分類、圖片） | 201；回到「我的刊登」；DB 新增記錄 | Use Case |
| TC-LS02 | 邊界值-名稱長度 | 名稱最短/最長 | 400 或成功；訊息清楚；DB 狀態一致 | 邊界值分析 |
| TC-LS03 | 非法圖片格式 | 非支援檔案類型 | 400；提示錯誤；不儲存 | 等價劃分 |
| TC-LS04 | 編輯刊登 | 變更描述/分類 | 200；資料更新；審計記錄 | Use Case |
| TC-LS05 | 刪除刊登 | 擁有者操作 | 200；記錄刪除或標記為刪除；列表不顯示 | Use Case |
| TC-LS06 | 越權編輯/刪除 | 非擁有者 | 403；不變更資料；審計記錄 | 安全性測試 |
| TC-LS07 | 列表顯示 | 多筆刊登 | 200；UI 分頁顯示正確 | Use Case |

測試模組：搜尋與篩選（分頁/排序）

- 測試目的：驗證搜尋條件綁定、白名單排序與分頁邊界。

| 測試編號 | 情境描述 | 輸入資料 | 預期結果 | 測試方法/技術 |
| :--- | :--- | :--- | :--- | :--- |
| TC-SR01 | 成功搜尋 | `q=phone, category=electronics` | 200；列表顯示符合項；分頁資訊正確 | Use Case |
| TC-SR02 | 邊界值-分頁 | `page=-1,size=1000` | 400 或採用預設值；UI 反映正確 | 邊界值分析 |
| TC-SR03 | 非法排序欄位 | `sort=DROP TABLE` | 400；拒絕非法欄位；安全記錄 | 等價劃分/安全性 |
| TC-SR04 | 無結果 | 罕見關鍵字 | 200；顯示「無結果」訊息；無錯誤 | Use Case |

測試模組：交換提案（建立/接受/拒絕/取消）

- 測試目的：驗證提案唯一性、權限與狀態機轉換。

| 測試編號 | 情境描述 | 輸入資料 | 預期結果 | 測試方法/技術 |
| :--- | :--- | :--- | :--- | :--- |
| TC-PR01 | 成功建立提案 | 合法對象與物品 | 201；提案狀態 `pending`；通知發送 | Use Case |
| TC-PR02 | 自提案禁止 | 使用者對自身刊登 | 400/403；錯誤碼 `ERR_SELF_SWAP_FORBIDDEN` | 等價劃分 |
| TC-PR03 | 重複提案 | 同一對象與刊登 | 409；錯誤碼 `ERR_DUPLICATE_PROPOSAL`；無新記錄 | 錯誤猜測 |
| TC-PR04 | 接受提案 | 對方接受 | 200；狀態 `accepted`；後續可建立出貨 | Use Case |
| TC-PR05 | 拒絕提案 | 對方拒絕 | 200；狀態 `rejected`；通知更新 | Use Case |
| TC-PR06 | 取消提案 | 發起方取消 | 200；狀態 `cancelled`；不可再操作 | Use Case |
| TC-PR07 | 越權操作 | 非參與者嘗試接受/拒絕 | 403；不變更狀態；審計記錄 | 安全性測試 |

測試模組：協商聊天（訊息、房間狀態）

- 測試目的：驗證聊天室狀態與訊息驗證、黑名單阻擋。

| 測試編號 | 情境描述 | 輸入資料 | 預期結果 | 測試方法/技術 |
| :--- | :--- | :--- | :--- | :--- |
| TC-CH01 | 成功送出訊息 | 合法文字訊息 | 201；訊息顯示於房間；未讀數更新 | Use Case |
| TC-CH02 | 房間封閉 | 房間狀態 `closed` | 403；拒絕送出；審計記錄 | 等價劃分 |
| TC-CH03 | 黑名單使用者 | 被封禁帳號 | 403；拒絕加入/發言；審計記錄 | 安全性測試 |
| TC-CH04 | XSS 嘗試 | HTML/JS 內容 | 200；輸出編碼；不執行腳本 | 安全性測試 |

測試模組：配送設定與物流追蹤（面交/交貨便）

- 測試目的：驗證配送模式設定、服務代碼流程、追蹤事件映射與超時重試。

| 測試編號 | 情境描述 | 輸入資料 | 預期結果 | 測試方法/技術 |
| :--- | :--- | :--- | :--- | :--- |
| TC-SH01 | 設定面交 | 地點/時間合法 | 200；記錄更新；雙方可見 | Use Case |
| TC-SH02 | 設定交貨便 | 有效門市/服務代碼 | 200；記錄更新；可追蹤 | Use Case |
| TC-SH03 | 非法門市/代碼 | 空值/錯誤格式 | 400；提示錯誤；不更新 | 等價劃分 |
| TC-TR01 | 追蹤事件序列 | `created→picked→in_transit→out_for_delivery→delivered` | 200；狀態機依序更新；逆序拒絕 | Use Case |
| TC-TR02 | 未知事件碼 | `etracking` 回傳未知 | 200；標記 `pending-review`；告警 | 錯誤猜測 |
| TC-TR03 | 查詢超時重試 | 連續超時 3 次 | 200；退避延遲遞增；不阻塞主流程 | 邏輯驗證 |

測試模組：送達確認（雙方簽收）

- 測試目的：驗證雙方確認流程與完成條件、提醒機制。

| 測試編號 | 情境描述 | 輸入資料 | 預期結果 | 測試方法/技術 |
| :--- | :--- | :--- | :--- | :--- |
| TC-DL01 | 單方先確認 | A 確認、B 未確認 | 200；狀態 `awaiting-counterparty`；提醒排程 | Use Case |
| TC-DL02 | 雙方確認完成 | A、B 皆確認 | 200；交易完成；後續評價（若未實作則不觸發） | Use Case |
| TC-DL03 | 越權確認 | 非交易雙方 | 403；拒絕；審計記錄 | 安全性測試 |

測試模組：郵件通知（模板渲染/寄送）

- 測試目的：驗證模板佔位符完整性、寄送成功/失敗處理與重試策略。

| 測試編號 | 情境描述 | 輸入資料 | 預期結果 | 測試方法/技術 |
| :--- | :--- | :--- | :--- | :--- |
| TC-EM01 | 渲染成功並寄送 | 完整模板+合法變數 | 202；SMTP 呼叫成功；審計記錄 | Use Case |
| TC-EM02 | 佔位符缺失 | 缺少必填變數 | 400；渲染失敗；不寄送；錯誤記錄 | 等價劃分 |
| TC-EM03 | SMTP 失敗重試 | 模擬連線異常 | 5xx；按策略重試；失敗告警 | 錯誤猜測 |

